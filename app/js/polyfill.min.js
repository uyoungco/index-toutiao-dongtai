// Promise
!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?n():"function"==typeof define&&define.amd?define(n):n()}(0,function(){"use strict";function e(e){var n=this.constructor;return this.then(function(t){return n.resolve(e()).then(function(){return t})},function(t){return n.resolve(e()).then(function(){return n.reject(t)})})}function n(){}function t(e){if(!(this instanceof t))throw new TypeError("Promises must be constructed via new");if("function"!=typeof e)throw new TypeError("not a function");this._state=0,this._handled=!1,this._value=undefined,this._deferreds=[],u(e,this)}function o(e,n){for(;3===e._state;)e=e._value;0!==e._state?(e._handled=!0,t._immediateFn(function(){var t=1===e._state?n.onFulfilled:n.onRejected;if(null!==t){var o;try{o=t(e._value)}catch(f){return void i(n.promise,f)}r(n.promise,o)}else(1===e._state?r:i)(n.promise,e._value)})):e._deferreds.push(n)}function r(e,n){try{if(n===e)throw new TypeError("A promise cannot be resolved with itself.");if(n&&("object"==typeof n||"function"==typeof n)){var o=n.then;if(n instanceof t)return e._state=3,e._value=n,void f(e);if("function"==typeof o)return void u(function(e,n){return function(){e.apply(n,arguments)}}(o,n),e)}e._state=1,e._value=n,f(e)}catch(r){i(e,r)}}function i(e,n){e._state=2,e._value=n,f(e)}function f(e){2===e._state&&0===e._deferreds.length&&t._immediateFn(function(){e._handled||t._unhandledRejectionFn(e._value)});for(var n=0,r=e._deferreds.length;r>n;n++)o(e,e._deferreds[n]);e._deferreds=null}function u(e,n){var t=!1;try{e(function(e){t||(t=!0,r(n,e))},function(e){t||(t=!0,i(n,e))})}catch(o){if(t)return;t=!0,i(n,o)}}var c=setTimeout;t.prototype["catch"]=function(e){return this.then(null,e)},t.prototype.then=function(e,t){var r=new this.constructor(n);return o(this,new function(e,n,t){this.onFulfilled="function"==typeof e?e:null,this.onRejected="function"==typeof n?n:null,this.promise=t}(e,t,r)),r},t.prototype["finally"]=e,t.all=function(e){return new t(function(n,t){function o(e,f){try{if(f&&("object"==typeof f||"function"==typeof f)){var u=f.then;if("function"==typeof u)return void u.call(f,function(n){o(e,n)},t)}r[e]=f,0==--i&&n(r)}catch(c){t(c)}}if(!e||"undefined"==typeof e.length)throw new TypeError("Promise.all accepts an array");var r=Array.prototype.slice.call(e);if(0===r.length)return n([]);for(var i=r.length,f=0;r.length>f;f++)o(f,r[f])})},t.resolve=function(e){return e&&"object"==typeof e&&e.constructor===t?e:new t(function(n){n(e)})},t.reject=function(e){return new t(function(n,t){t(e)})},t.race=function(e){return new t(function(n,t){for(var o=0,r=e.length;r>o;o++)e[o].then(n,t)})},t._immediateFn="function"==typeof setImmediate&&function(e){setImmediate(e)}||function(e){c(e,0)},t._unhandledRejectionFn=function(e){void 0!==console&&console&&console.warn("Possible Unhandled Promise Rejection:",e)};var l=function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if("undefined"!=typeof global)return global;throw Error("unable to locate global object")}();"Promise"in l?l.Promise.prototype["finally"]||(l.Promise.prototype["finally"]=e):l.Promise=t});


// map filter Object.defineProperty  assign
Array.prototype.map||(Array.prototype.map=function(r,e){var t,o,n;if(null==this)throw new TypeError(" this is null or not defined");var i=Object(this),p=i.length>>>0;if("[object Function]"!=Object.prototype.toString.call(r))throw new TypeError(r+" is not a function");for(e&&(t=e),o=new Array(p),n=0;n<p;){var c,a;n in i&&(c=i[n],a=r.call(t,c,n,i),o[n]=a),n++}return o}),Array.prototype.filter||(Array.prototype.filter=function(r){if(null==this)throw new TypeError;var e=Object(this),t=e.length>>>0;if("function"!=typeof r)throw new TypeError;for(var o=[],n=arguments[1],i=0;i<t;i++)if(i in e){var p=e[i];r.call(n,p,i,e)&&o.push(p)}return o}),/\[native code\]/.test(Object.create)||(Object.create=function(r){var e=function(){};return e.prototype=r,new e});var origDefineProperty=Object.defineProperty,arePropertyDescriptorsSupported=function(){var r={};try{for(var e in origDefineProperty(r,"x",{enumerable:!1,value:r}),r)return!1;return r.x===r}catch(r){return!1}},supportsDescriptors=origDefineProperty&&arePropertyDescriptorsSupported();supportsDescriptors||(Object.defineProperty=function(r,e,t){if(origDefineProperty&&1==r.nodeType)return origDefineProperty(r,e,t);r[e]=t.value||t.get&&t.get()}),"function"!=typeof Object.assign&&(Object.assign=function(r){if(null==r)throw new TypeError("Can not convert undefined or null to object");for(var e=Object(r),t=1,o=arguments.length;t<o;t++){var n=arguments[t];if(null!=n)for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e});

//解决 IE8 不支持console
window.console = window.console || (function () {
  var c = {}; c.log = c.warn = c.debug = c.info = c.error = c.time = c.dir = c.profile
  = c.clear = c.exception = c.trace = c.assert = function () { };
  return c;
})();

// getNowFormatDate addStyleJs
function getNowFormatDate() {
  var date = new Date();
  var seperator1 = "";
  var year = date.getFullYear();
  var month = date.getMonth() + 1;
  var strDate = date.getDate();
  var Hours = date.getHours();
  if (month >= 1 && month <= 9) {
    month = "0" + month;
  }
  if (strDate >= 0 && strDate <= 9) {
    strDate = "0" + strDate;
  }
  var currentdate = year + seperator1 + month + seperator1 + strDate + seperator1 + Hours;
  return currentdate;
}

var addStyleJs = function (dom) {
  var cache = {},

  /*缓存加载过的css或者js*/
  funct;
  /**
   * HTML动态加载css或者js
   * @path {String} src 或 link 地址必须带有后缀名.js或者.css
   * @callback {Function} 加载成功的回掉函数
   * */
  funct = function funct(path, callback) {
    if (!path) {
      /*检查路径是否为空*/
      throw new Error("请输入path路径!");
    };
    var fn = Object.prototype.toString.call(callback) == "[object Function]" ? callback : function () {};
    if (".js" == path.substr(-3)) {
      /*检查路径后缀名是否为.js*/
      addJs(path + "?" + getNowFormatDate(), fn);
    } else if (".css" == path.substr(-4)) {
      /*检查路径后缀名是否为.css*/
      addCss(path, fn);
    } else {
      // throw new Error('请输入正确的path路径!');
      if(".js" == path.substr(path.length-3,path.length)) {
        addJs(path + "?" + getNowFormatDate(), fn);
      } else if (".css" == path.substr(path.length-4,path.length)) {
        /*检查路径后缀名是否为.css*/
        addCss(path, fn);
      } else {
        throw new Error('请输入正确的path路径!');
      }
    }
  };
  /**
   * HTML 动态添加 CSS
   * @path {String}  link 地址必须带有后缀名.css
   * @callback {Function} 加载成功的回掉函数
   * */
  function addCss(path, callback) {
    if (!checkcache(path)) {
      /*检查是否加载过*/
      var head = dom.getElementsByTagName('head')[0];
      var link = dom.createElement('link');
      link.href = path;
      link.rel = 'stylesheet';
      link.type = 'text/css';
      head.appendChild(link); /*添加到HTML中*/
      link.onload = link.onreadystatechange = function () {
        /*判断是否加载成功*/
        if (!this.readyState || this.readyState === "loaded" || this.readyState === "complete") {
          link.onload = link.onreadystatechange = null;
          callback();
        }
      };
      cache[path] = 1; /*存储加载过的css路径,值设为1*/
    }
  };
  /**
   * HTML动态加载js
   * @path {String} src 地址必须带有后缀名.js
   * @callback {Function} 加载成功的回掉函数
   * */
  function addJs(path, callback) {
    if (!checkcache(path)) {
      /*检查是否加载过*/
      var head = dom.getElementsByTagName('head')[0];
      var script = dom.createElement('script');
      script.src = path;
      script.type = 'text/javascript';
      head.appendChild(script); /*添加到HTML中*/
      script.onload = script.onreadystatechange = function () {
        /*判断是否加载成功*/
        if (!this.readyState || this.readyState === "loaded" || this.readyState === "complete") {
          script.onload = script.onreadystatechange = null;
          callback();
        }
      };
      cache[path] = 1; /*存储加载过的js路径,值设为1*/
    }
  };
  /**
   * 检查是否加载
   * @path {String} 路径
   * */
  function checkcache(path) {
    if (cache[path]) {
      /*判断是否加载过的js路径*/
      return true;
    } else {
      return false;
    }
  };
  return funct;
}(document);